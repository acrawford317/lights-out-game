<!-- 
    https://cs4640.cs.virginia.edu/akc4vf/hw7/ 
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">  
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Ashley Crawford">
        <meta name="description" content="Lights Out Game">  
        <title>Lights Out Game</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous"> 
    
        <style>
            table, th, td {
                border: 1px solid black;
                padding:30px;
                background-color: lightblue;
            }
        </style>

        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    </head>
    <body onload="addBox()">
        <div class="container" style="margin-top: 15px;">
            <div class="row col-xs-8">
                <h1>Lights Out Game</h1>
                <p> Enter the numbers of rows and columns to start the game.</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-4">
                <form action="index.html" method="get" id="myForm">
                    <div class="mb-3">
                        <label for="columnsNum" class="form-label">Number of Columns</label>
                        <input type="number" min="1" class="form-control" id="columnsNum" name="columnsNum" required/>
                    </div>
                    <div class="mb-3">
                        <label for="rowsNum" class="form-label">Number of Rows</label>
                        <input type="number" min="1" class="form-control" id="rowsNum" name="rowsNum" required/>
                    </div>
                    <div class="text-center">                
                        <button type=submit class="btn btn-primary">Start Game</button>
                    </div>
                </form>
                </div>
            </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 10px;">
            <div class="col-2">
                <p id="error" style="color: red;"></p>
            </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 70px;">
            <div class="col-2">
                <table id="table-game">

                </table>
            </div>
        </div>
        
        <script type="text/javascript">

        var won = false;
        var json;
        var r = 0;
        var c = 0;

        function addBox() { 

            event.preventDefault();

            document.getElementById("table-game").innerHTML = "";

            var table = document.getElementById("table-game");

            var queryString = window.location.search;
            var urlParams = new URLSearchParams(queryString);
            r = urlParams.get('rowsNum');
            c = urlParams.get('columnsNum');

            if(r == null || c == null){
                return;
            }

            var row;
            var cell;

            var count = 1;

            for(let i=0; i<r; i++){
                row = table.insertRow(i);

                for(let j=0; j<c; j++){
                    cell = row.insertCell(j);
                    cell.innerHTML = "<td></td>";
                    cell.id = count + "";
                    count += 1;
                }
            }

            document.getElementById("rowsNum").value = "";
            document.getElementById("columnsNum").value = "";
        }

        $('#table-game').on( 'click', 'td', function () {
            this.style.backgroundColor = this.style.backgroundColor == 'blue' ? 'lightblue' : 'blue';

            if(this.id % parseInt(c) != 0){
                var id_right = parseInt(this.id) + 1;
                $('#'+id_right+"").css("background-color", $('#'+id_right+"").css("background-color") == 'rgb(0, 0, 255)' ? 'lightblue' : 'blue');
            }

            if((this.id-1) % parseInt(c) != 0){
                var id_left = parseInt(this.id) - 1;
                $('#'+id_left+"").css("background-color", $('#'+id_left+"").css("background-color") == 'rgb(0, 0, 255)' ? 'lightblue' : 'blue');
            }

            var id_down = parseInt(this.id) + parseInt(c);
            $('#'+id_down+"").css("background-color", $('#'+id_down+"").css("background-color") == 'rgb(0, 0, 255)' ? 'lightblue' : 'blue');

            var id_up = parseInt(this.id) - c;
            $('#'+id_up+"").css("background-color", $('#'+id_up+"").css("background-color") == 'rgb(0, 0, 255)' ? 'lightblue' : 'blue');
        });


        var queryString = window.location.search;
        var urlParams = new URLSearchParams(queryString);
        r = urlParams.get('rowsNum');
        c = urlParams.get('columnsNum');

         $.ajax({
            url : "setup.php",
            type : 'GET',
            data: {
                'columnsNum': c,
                'rowsNum': r
            },
            success : function(response) {              
                alert('Data: ' + response);
                json = response;
            },
            error : function(request,error) {
                alert("ERROR:" + error);
            }
        });

        
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    </body>
</html>